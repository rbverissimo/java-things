
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/vue-container-layout}">
<head layout:fragment="title" th:insert="fragments/title :: title(title = 'Farmacinha - Listas de farmácias')"></head>
    <div class="mt-5" layout:fragment="content">

        <th:block th:if="${remedios.size > 0}" th:insert="components/toolbar :: lightToolbar(~{::#toolbar-catalogo})">
            <div class="w-100 d-flex justify-content-end" id="toolbar-catalogo" th:fragment="toolbarCatalogo">
                <div class="col-6 d-inline-flex">
                    <input type="search" placeholder="Digite o nome do remédio" v-model="remedioSearch" @keyup="buscarRemedios" class="form-control me-2">
                    <button class="btn btn-sm btn-outline-success" type="submit">Buscar</button>
                </div>
            </div>
        </th:block>

        <div v-for="remedio in remediosList" :key="remedio.id" class="card mt-5">
            <div class="card-header d-inline-flex flex-wrap justify-content-between">
                <div class="d-flex">
                    <a class="d-flex align-items-center" style="cursor:pointer" href="#">
                        <span class="material-symbols-outlined">medication</span>
                        <span>{{remedio.nome}}</span>
                    </a>
                </div>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-danger d-flex align-items-center">
                        <i class="material-symbols-outlined me-1">delete</i>Deletar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <p>Data de início do último tratamento: <span>{{renderizarData(remedio.dataInicioTratamento)}}</span></p>
                <p>Alocado na farmácia: <span>{{remedio.farmaciaAlocado}}</span> </p>
            </div>
            <div class="card-footer d-flex justify-content-end">
                <div class="col-3">
                    <a href="#" role="button" class="btn btn-sm btn-outline-primary w-100">Gramaturas</a>
                </div>
                <div v-if="doses < 1" class="col-3">
                    <a href="#" class="btn btn-sm btn-outline-primary w-100">Novo tratamento</a>
                </div>
            </div>

        </div>

    </div>
    <script type="module" th:inline="javascript" layout:fragment="vue-app">
        import { createApp, ref, onMounted, watch } from '/webjars/vue/dist/vue.esm-browser.prod.js';
        import { renderizarData } from '/js/masks.js';
        import { debounce } from '/js/reactive.js';

        const serverData = {
            remedios: /*[[${remedios}]]*/ []
        };

        const app = createApp({
            setup(){
                const remedioSearch = ref('');
                const remediosList = ref([]);

                onMounted(() => {
                    remediosList.value = serverData.remedios;
                });

                const buscarRemedios = debounce(async () => {
                    if(remedioSearch.value.length < 4) return;
                    console.log(remedioSearch.value);

                }, 500);

                return {
                    remedioSearch,
                    remediosList,
                    renderizarData,
                    buscarRemedios
                };

            }
        });

        app.mount('#app');

    </script>
</html>